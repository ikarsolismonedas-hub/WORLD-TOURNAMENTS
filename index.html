<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Ranking de Copas - 8 Ball Pool</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
    body {
        background: #050712;
        color: white;
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
    }

    .transmisiÃ³n-box {
        width: 90%;
        margin: 40px auto;
        padding: 20px;
        background: #0b0f1f;
        border-radius: 12px;
        border: 1px solid #0ef2dd55;
    }

    .transmisiÃ³n-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
    }

    .btn {
        padding: 10px 18px;
        border-radius: 8px;
        border: none;
        cursor: pointer;
        font-weight: bold;
    }

    .btn-green {
        background: #16a34a;
        color: white;
    }

    .btn-red {
        background: #dc2626;
        color: white;
    }

    #liveVideo {
        width: 100%;
        height: 300px;
        background: black;
        border-radius: 8px;
        border: 1px solid #0ef2dd55;
    }
</style>
</head>

<body>

<!-- â­â­â­ TU PÃGINA COMPLETA DE RANKING IRÃA AQUÃ â­â­â­ -->
<!-- MantÃ©n el resto de tu diseÃ±o arriba -->

<!-- =======================
     ðŸ”´ TRANSMISIÃ“N EN VIVO
     ======================= -->
<div class="transmisiÃ³n-box">
    <div class="transmisiÃ³n-header">
        <h3>ðŸ”´ TransmisiÃ³n en vivo Â· Mesas & Jugadas</h3>

        <button class="btn btn-green"
            onclick="window.open('broadcaster.html', '_blank')">
            ðŸš€ Soy el streamer (compartir pantalla)
        </button>
    </div>

    <video id="liveVideo" autoplay playsinline></video>
</div>

<!-- =======================
     ðŸ”— SCRIPT VIEWER
     ======================= -->
<script src="https://cdn.socket.io/4.8.1/socket.io.min.js"></script>

<script>
const socket = io("https://streaming-torneos-server-1.onrender.com");
const video = document.getElementById("liveVideo");
let pc;

function createPeerConnection() {
    pc = new RTCPeerConnection({
        iceServers: [
            { urls: "stun:stun.l.google.com:19302" }
        ]
    });

    pc.ontrack = (event) => {
        video.srcObject = event.streams[0];
    };

    pc.onicecandidate = (event) => {
        if (event.candidate) {
            socket.emit("viewer-candidate", event.candidate);
        }
    };
}

async function startViewer() {
    createPeerConnection();

    const offer = await pc.createOffer();
    await pc.setLocalDescription(offer);

    socket.emit("viewer-offer", offer);

    socket.on("broadcaster-answer", async (answer) => {
        await pc.setRemoteDescription(answer);
    });

    socket.on("broadcaster-candidate", (candidate) => {
        pc.addIceCandidate(new RTCIceCandidate(candidate));
    });
}

socket.on("broadcaster-is-live", () => {
    startViewer();
});
</script>

</body>
</html>
